---

- name: create a local yum repository
  hosts: localhost
  connection: local
  become: true
  become_user: root

  vars:
    iso: /home/wmcdonal/ansible-lab-setup/files/CentOS-7-x86_64-Minimal-1511.iso
    docroot: /var/www/html

  tasks:
  - name: create the mount point # nb: mount does this automatically, just to be explicit
    file:
      path: /mnt/iso
      state: directory

  - name: mount the iso
    mount:
      fstype: iso9660
      name: /mnt/iso
      opts: ro
      src: "{{ iso }}"
      state: mounted

  - name: create the repository directory
    file:
      path: "{{ docroot }}/repos/centos/7"
      state: directory

  - name: copy the rpms
    copy:
      dest: "{{ docroot }}/repos/centos/7"
      src: /mnt/iso/Packages

  # - name: create the repository metadata

  - name: unmount the iso
    mount:
      fstype: iso9660
      name: /mnt/iso
      opts: ro
      src: "{{ iso }}"
      state: unmounted


# vim:sw=2:ts=2:et:ai
